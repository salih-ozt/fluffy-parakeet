<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agro Dev â€” Agrolink GeliÅŸtirici PortalÄ±</title>
    <link rel="icon" type="image/png" href="agro.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background: #0a0e1a; color: #e2e8f0; min-height: 100vh; }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #7c3aed; border-radius: 3px; }

        /* Background grid */
        .bg-grid {
            background-image: linear-gradient(rgba(124,58,237,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(124,58,237,0.05) 1px, transparent 1px);
            background-size: 50px 50px;
        }

        /* Glow effects */
        .glow-purple { box-shadow: 0 0 30px rgba(124,58,237,0.3), 0 0 60px rgba(124,58,237,0.1); }
        .glow-green { box-shadow: 0 0 30px rgba(22,163,74,0.3), 0 0 60px rgba(22,163,74,0.1); }
        .text-gradient { background: linear-gradient(135deg, #a855f7, #7c3aed, #4f46e5); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .text-gradient-green { background: linear-gradient(135deg, #22c55e, #16a34a); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }

        /* Glass cards */
        .glass { background: rgba(255,255,255,0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.08); }
        .glass-strong { background: rgba(255,255,255,0.06); backdrop-filter: blur(30px); border: 1px solid rgba(255,255,255,0.12); }

        /* Navbar */
        .navbar { background: rgba(10,14,26,0.9); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(124,58,237,0.2); }

        /* Tab styles */
        .tab-btn { transition: all 0.2s ease; }
        .tab-btn.active { background: rgba(124,58,237,0.2); color: #a855f7; border-color: #7c3aed; }

        /* Form inputs */
        .dev-input {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: #e2e8f0;
            transition: all 0.2s;
        }
        .dev-input:focus {
            outline: none;
            border-color: #7c3aed;
            box-shadow: 0 0 0 3px rgba(124,58,237,0.15);
            background: rgba(124,58,237,0.05);
        }
        .dev-input::placeholder { color: rgba(226,232,240,0.3); }

        /* Button */
        .btn-dev { 
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        .btn-dev::before { content:''; position:absolute; inset:0; background:linear-gradient(135deg,rgba(255,255,255,0.1),transparent); opacity:0; transition:opacity 0.3s; }
        .btn-dev:hover::before { opacity:1; }
        .btn-dev:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(124,58,237,0.4); }
        .btn-dev:active { transform: translateY(0); }

        .btn-green {
            background: linear-gradient(135deg, #16a34a, #15803d);
            transition: all 0.3s;
        }
        .btn-green:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(22,163,74,0.4); }

        /* API Key card */
        .api-key-card { 
            background: rgba(124,58,237,0.05);
            border: 1px solid rgba(124,58,237,0.2);
            transition: all 0.3s;
        }
        .api-key-card:hover { border-color: rgba(124,58,237,0.4); background: rgba(124,58,237,0.08); }

        /* Code block */
        .code-block {
            background: #0f172a;
            border: 1px solid rgba(124,58,237,0.2);
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            color: #94a3b8;
        }
        .code-keyword { color: #a855f7; }
        .code-string { color: #22c55e; }
        .code-comment { color: #475569; }
        .code-var { color: #60a5fa; }

        /* Status badge */
        .badge-active { background: rgba(22,163,74,0.2); color: #22c55e; border: 1px solid rgba(22,163,74,0.3); }
        .badge-inactive { background: rgba(239,68,68,0.2); color: #f87171; border: 1px solid rgba(239,68,68,0.3); }

        /* Plan badge */
        .badge-free { background: rgba(226,232,240,0.1); color: #94a3b8; }
        .badge-pro { background: rgba(124,58,237,0.2); color: #a855f7; }

        /* Sidebar nav */
        .sidebar-link { transition: all 0.2s; }
        .sidebar-link:hover, .sidebar-link.active { background: rgba(124,58,237,0.15); color: #a855f7; }
        .sidebar-link.active { border-left: 3px solid #7c3aed; }

        /* Animations */
        @keyframes fadeUp { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }
        .fade-up { animation: fadeUp 0.4s ease forwards; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .spin { animation: spin 1s linear infinite; }
        
        /* Key reveal animation */
        @keyframes keyReveal { 0% { letter-spacing: -0.5em; opacity:0; } 100% { letter-spacing: 0; opacity:1; } }
        .key-reveal { animation: keyReveal 0.4s ease forwards; }

        /* Pulse dot */
        @keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:0.5;transform:scale(1.2)} }
        .pulse-dot { animation: pulse 2s ease-in-out infinite; }

        /* Modal */
        .modal-overlay { background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); }
        .modal-overlay.hidden { display: none; }
        
        /* Section hidden by default */
        .section { display: none; }
        .section.active { display: block; }
        
        /* Scrollable usage log */
        .usage-log { max-height: 300px; overflow-y: auto; }

        /* â”€â”€ OTP Inputs â”€â”€ */
        .otp-input {
            width: 48px; height: 56px;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px; color: #e2e8f0;
            font-size: 20px; font-weight: 800; text-align: center;
            transition: all 0.2s; outline: none;
        }
        .otp-input:focus { border-color: #7c3aed; box-shadow: 0 0 0 3px rgba(124,58,237,0.2); background: rgba(124,58,237,0.07); }
        .otp-input.filled { border-color: rgba(124,58,237,0.6); color: #a855f7; }

        /* â”€â”€ Auth Steps â”€â”€ */
        .auth-step { animation: fadeUp 0.3s ease; }
        .auth-step.hidden { display: none; }
        @keyframes fadeUp { from { opacity:0; transform:translateY(12px); } to { opacity:1; transform:translateY(0); } }

        /* â”€â”€ Plan Cards â”€â”€ */
        .plan-card { border-radius: 24px; transition: transform 0.3s, box-shadow 0.3s; }
        .plan-card:hover { transform: translateY(-4px); }
        .plan-popular { box-shadow: 0 0 50px rgba(124,58,237,0.25); }
        .popular-badge {
            position: absolute; top: -13px; left: 50%; transform: translateX(-50%);
            background: linear-gradient(135deg,#7c3aed,#4f46e5);
            color: white; font-size: 11px; font-weight: 800;
            padding: 3px 16px; border-radius: 999px; white-space: nowrap;
            box-shadow: 0 4px 15px rgba(124,58,237,0.4);
        }

        /* â”€â”€ Progress bar â”€â”€ */
        .prog-track { background: rgba(255,255,255,0.06); border-radius: 999px; overflow: hidden; height: 8px; }
        .prog-fill { height: 100%; border-radius: 999px; transition: width 0.8s cubic-bezier(.4,0,.2,1); }
        .prog-ok     { background: linear-gradient(90deg,#22c55e,#16a34a); }
        .prog-warn   { background: linear-gradient(90deg,#f59e0b,#d97706); }
        .prog-danger { background: linear-gradient(90deg,#ef4444,#dc2626); }

        /* â”€â”€ Toast notifications â”€â”€ */
        #toast-wrap { position:fixed; bottom:24px; right:24px; z-index:9999; display:flex; flex-direction:column; gap:8px; pointer-events:none; }
        .toast { pointer-events:auto; min-width:240px; padding:12px 16px; border-radius:14px; font-size:13px; font-weight:600; display:flex; align-items:center; gap:10px; backdrop-filter:blur(20px); border:1px solid; box-shadow:0 8px 30px rgba(0,0,0,0.3); animation:fadeUp 0.3s ease; }
        .toast-ok   { background:rgba(22,163,74,0.2); border-color:rgba(22,163,74,0.4); color:#4ade80; }
        .toast-err  { background:rgba(239,68,68,0.2); border-color:rgba(239,68,68,0.4); color:#f87171; }
        .toast-info { background:rgba(124,58,237,0.2); border-color:rgba(124,58,237,0.4); color:#c084fc; }

        /* â”€â”€ Rate limit badge â”€â”€ */
        .rl-badge { display:inline-flex; align-items:center; gap:5px; padding:3px 10px; border-radius:999px; font-size:11px; font-weight:700; }
        .rl-free { background:rgba(148,163,184,0.12); color:#94a3b8; border:1px solid rgba(148,163,184,0.2); }
        .rl-pro  { background:rgba(124,58,237,0.15); color:#c084fc; border:1px solid rgba(124,58,237,0.35); }

        /* â”€â”€ Countdown â”€â”€ */
        .countdown { font-variant-numeric:tabular-nums; color:#a855f7; font-weight:700; }

        /* â”€â”€ Pro disabled button â”€â”€ */
        .btn-disabled { opacity:0.55; cursor:not-allowed !important; background: linear-gradient(135deg,#7c3aed,#4f46e5) !important; }
    </style>
</head>
<body class="bg-grid">
<!-- Toast container -->
<div id="toast-wrap"></div>

    <!-- ========== NAVBAR ========== -->
    <nav class="navbar sticky top-0 z-50 px-4 py-3">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-4">
                <a href="/" class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors text-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                    Ana Sayfa
                </a>
                <span class="text-gray-700">|</span>
                <a href="/" class="flex items-center gap-2">
                    <img src="agro.png" alt="Agro" class="w-8 h-8 rounded-lg">
                    <span class="font-black text-white">Agro<span style="color:#a855f7;">Dev</span></span>
                </a>
                <div class="hidden sm:flex items-center gap-1.5 px-3 py-1 rounded-full" style="background:rgba(124,58,237,0.15);border:1px solid rgba(124,58,237,0.3);">
                    <div class="w-1.5 h-1.5 rounded-full bg-purple-400 pulse-dot"></div>
                    <span class="text-purple-300 text-xs font-semibold">AI API v1.0</span>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <a href="/help.html" class="text-gray-400 hover:text-white transition-colors text-sm hidden sm:block">Docs</a>
                <div id="nav-user-info" class="hidden items-center gap-2">
                    <div class="w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center text-sm font-bold" id="nav-avatar">?</div>
                    <span class="text-sm font-medium hidden sm:block" id="nav-username">-</span>
                </div>
                <button id="nav-logout-btn" onclick="logout()" class="hidden text-sm text-gray-400 hover:text-red-400 transition-colors">Ã‡Ä±kÄ±ÅŸ</button>
                <div id="nav-auth-btns" class="flex gap-2">
                    <button onclick="showAuthModal('login')" class="text-sm text-gray-300 hover:text-white transition-colors px-3 py-1.5 rounded-lg border border-gray-700 hover:border-gray-500">GiriÅŸ Yap</button>
                    <button onclick="showAuthModal('register')" class="btn-dev text-white text-sm font-semibold px-4 py-1.5 rounded-lg">KayÄ±t Ol</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ========== HERO (not logged in) ========== -->
    <div id="hero-section">
        <div class="max-w-7xl mx-auto px-4 py-20 text-center">
            <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-semibold mb-6" style="background:rgba(124,58,237,0.15);border:1px solid rgba(124,58,237,0.3);color:#a855f7;">
                ğŸš€ Agrolink Yapay Zeka API'sine EriÅŸim
            </div>
            <h1 class="text-5xl sm:text-6xl lg:text-7xl font-black mb-6 leading-tight">
                <span class="text-white">Agrolink</span><br>
                <span class="text-gradient">AI API</span>
            </h1>
            <p class="text-xl text-gray-400 max-w-2xl mx-auto mb-10">
                TarÄ±m yapay zekasÄ±nÄ±n gÃ¼cÃ¼nÃ¼ kendi uygulamanÄ±za entegre edin. 
                API anahtarÄ± alÄ±n, dakikalar iÃ§inde baÅŸlayÄ±n.
            </p>
            <div class="flex flex-wrap gap-4 justify-center mb-16">
                <button onclick="showAuthModal('register')" class="btn-dev text-white font-bold px-8 py-4 rounded-2xl text-lg">
                    Ãœcretsiz BaÅŸla â†’
                </button>
                <a href="/help.html" class="glass text-gray-300 font-semibold px-8 py-4 rounded-2xl text-lg hover:text-white transition-colors">
                    DokÃ¼mantasyon
                </a>
            </div>

            <!-- Feature Cards -->
            <div class="grid sm:grid-cols-3 gap-6 max-w-4xl mx-auto mb-6">
                <div class="glass rounded-2xl p-6 text-left hover:scale-105 transition-transform">
                    <div class="text-3xl mb-3">ğŸŒ¾</div>
                    <h3 class="font-bold text-white mb-2">TarÄ±m AI Chat</h3>
                    <p class="text-gray-400 text-sm">Bitki hastalÄ±klarÄ±, sulama, gÃ¼breleme konularÄ±nda uzman AI yanÄ±tlarÄ±</p>
                </div>
                <div class="glass rounded-2xl p-6 text-left hover:scale-105 transition-transform">
                    <div class="text-3xl mb-3">ğŸ”’</div>
                    <h3 class="font-bold text-white mb-2">DoÄŸrulamalÄ± GiriÅŸ</h3>
                    <p class="text-gray-400 text-sm">Agro Sosyal hesabÄ±nÄ±z + e-posta OTP kodu ile gÃ¼venli eriÅŸim</p>
                </div>
                <div class="glass rounded-2xl p-6 text-left hover:scale-105 transition-transform">
                    <div class="text-3xl mb-3">âš¡</div>
                    <h3 class="font-bold text-white mb-2">HÄ±zlÄ± Entegrasyon</h3>
                    <p class="text-gray-400 text-sm">REST API, TÃ¼rkÃ§e dokÃ¼mantasyon, kolay kullanÄ±m</p>
                </div>
            </div>

            <!-- Stats bar -->
            <div class="max-w-3xl mx-auto grid grid-cols-2 sm:grid-cols-4 gap-4 mb-14">
                <div class="glass rounded-2xl p-4 text-center"><div class="text-xl font-black text-white">20</div><div class="text-xs text-gray-500 mt-0.5">istek/dk (Free)</div></div>
                <div class="glass rounded-2xl p-4 text-center"><div class="text-xl font-black text-white">1,000</div><div class="text-xs text-gray-500 mt-0.5">istek/ay (Free)</div></div>
                <div class="glass rounded-2xl p-4 text-center"><div class="text-xl font-black" style="background:linear-gradient(135deg,#a855f7,#7c3aed);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">âˆ</div><div class="text-xs text-gray-500 mt-0.5">istek/dk (Pro)</div></div>
                <div class="glass rounded-2xl p-4 text-center"><div class="text-xl font-black text-green-400">99.9%</div><div class="text-xs text-gray-500 mt-0.5">Uptime</div></div>
            </div>

            <!-- Plans -->
            <div class="max-w-4xl mx-auto" id="hero-plans">
                <h2 class="text-3xl font-black text-white text-center mb-3">Planlar & FiyatlandÄ±rma</h2>
                <p class="text-gray-400 text-center mb-10">Ä°htiyacÄ±nÄ±za gÃ¶re plan seÃ§in, istediÄŸiniz zaman yÃ¼kseltin.</p>
                <div class="grid sm:grid-cols-2 gap-6">
                    <!-- FREE -->
                    <div class="plan-card glass rounded-2xl p-8">
                        <div class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-bold mb-4" style="background:rgba(226,232,240,0.1);color:#94a3b8;border:1px solid rgba(148,163,184,0.2);">FREE</div>
                        <h3 class="text-2xl font-black text-white mb-1">Ãœcretsiz Plan</h3>
                        <div class="text-4xl font-black text-white mt-3 mb-6">â‚º0<span class="text-lg text-gray-500 font-normal">/ay</span></div>
                        <ul class="space-y-2.5 mb-8 text-sm">
                            <li class="flex items-center gap-2.5 text-gray-300"><span class="text-green-400 text-base">âœ“</span><strong class="text-white">20</strong>&nbsp;istek / dakika</li>
                            <li class="flex items-center gap-2.5 text-gray-300"><span class="text-green-400 text-base">âœ“</span><strong class="text-white">1,000</strong>&nbsp;istek / ay</li>
                            <li class="flex items-center gap-2.5 text-gray-300"><span class="text-green-400 text-base">âœ“</span>Maks. 10 API anahtarÄ±</li>
                            <li class="flex items-center gap-2.5 text-gray-300"><span class="text-green-400 text-base">âœ“</span>TarÄ±m AI Chat endpoint</li>
                            <li class="flex items-center gap-2.5 text-gray-300"><span class="text-green-400 text-base">âœ“</span>E-posta OTP doÄŸrulamasÄ±</li>
                            <li class="flex items-center gap-2.5 text-gray-500"><span>âœ—</span>Ã–ncelikli destek</li>
                            <li class="flex items-center gap-2.5 text-gray-500"><span>âœ—</span>SÄ±nÄ±rsÄ±z istek</li>
                        </ul>
                        <button onclick="showAuthModal('register')" class="btn-dev w-full text-white font-bold py-3.5 rounded-xl">Ãœcretsiz BaÅŸla</button>
                    </div>
                    <!-- PRO -->
                    <div class="plan-card plan-popular relative" style="background:rgba(124,58,237,0.07);border:1px solid rgba(124,58,237,0.35);padding:2rem;">
                        <div class="popular-badge">âœ¨ En PopÃ¼ler</div>
                        <div class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-bold mb-4" style="background:rgba(124,58,237,0.2);color:#c084fc;border:1px solid rgba(124,58,237,0.4);">PRO</div>
                        <h3 class="text-2xl font-black text-white mb-1">Pro Plan</h3>
                        <div class="text-4xl font-black mt-3 mb-6" style="background:linear-gradient(135deg,#a855f7,#7c3aed,#4f46e5);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">â‚º299<span class="text-lg text-gray-400 font-normal" style="-webkit-text-fill-color:#9ca3af">/ay</span></div>
                        <ul class="space-y-2.5 mb-8 text-sm">
                            <li class="flex items-center gap-2.5 text-gray-200"><span class="text-purple-400 text-base">âœ“</span><strong class="text-white">SÄ±nÄ±rsÄ±z</strong>&nbsp;istek / dakika</li>
                            <li class="flex items-center gap-2.5 text-gray-200"><span class="text-purple-400 text-base">âœ“</span><strong class="text-white">SÄ±nÄ±rsÄ±z</strong>&nbsp;istek / ay</li>
                            <li class="flex items-center gap-2.5 text-gray-200"><span class="text-purple-400 text-base">âœ“</span>SÄ±nÄ±rsÄ±z API anahtarÄ±</li>
                            <li class="flex items-center gap-2.5 text-gray-200"><span class="text-purple-400 text-base">âœ“</span>TÃ¼m AI endpointler</li>
                            <li class="flex items-center gap-2.5 text-gray-200"><span class="text-purple-400 text-base">âœ“</span>Ã–ncelikli destek + SLA</li>
                            <li class="flex items-center gap-2.5 text-gray-200"><span class="text-purple-400 text-base">âœ“</span>GeliÅŸmiÅŸ analitik & webhook</li>
                            <li class="flex items-center gap-2.5 text-gray-200"><span class="text-purple-400 text-base">âœ“</span>GÃ¶rÃ¼ntÃ¼ analizi (yakÄ±nda)</li>
                        </ul>
                        <button disabled class="btn-disabled w-full text-white font-bold py-3.5 rounded-xl mb-2" style="background:linear-gradient(135deg,#7c3aed,#4f46e5);">
                            ğŸ”’ Ã–deme AltyapÄ±sÄ± HazÄ±rlanÄ±yor
                        </button>
                        <p class="text-center text-xs text-purple-400 cursor-pointer hover:text-purple-300" onclick="showBetaToast()">Beta listesine kaydol â†’ Ã¶nce sen haberdar ol</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== DASHBOARD (logged in) ========== -->
    <div id="dashboard-section" class="hidden max-w-7xl mx-auto px-4 py-8">
        <div class="flex flex-col lg:flex-row gap-6">
            
            <!-- Sidebar -->
            <aside class="lg:w-56 flex-shrink-0">
                <div class="glass rounded-2xl p-4 sticky top-20">
                    <div class="flex items-center gap-3 p-3 mb-4">
                        <div class="w-10 h-10 rounded-xl bg-purple-600 flex items-center justify-center font-black text-white" id="sidebar-avatar">?</div>
                        <div>
                            <div class="font-semibold text-white text-sm" id="sidebar-username">-</div>
                            <div class="text-xs px-2 py-0.5 rounded-full badge-free font-medium" id="sidebar-plan">Free</div>
                        </div>
                    </div>
                    <nav class="space-y-1">
                        <button onclick="showSection('overview')" class="sidebar-link active w-full text-left px-3 py-2.5 rounded-xl text-sm font-medium text-gray-300 flex items-center gap-2" data-section="overview">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                            Genel BakÄ±ÅŸ
                        </button>
                        <button onclick="showSection('apikeys')" class="sidebar-link w-full text-left px-3 py-2.5 rounded-xl text-sm font-medium text-gray-300 flex items-center gap-2" data-section="apikeys">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>
                            API AnahtarlarÄ±m
                        </button>
                        <button onclick="showSection('docs')" class="sidebar-link w-full text-left px-3 py-2.5 rounded-xl text-sm font-medium text-gray-300 flex items-center gap-2" data-section="docs">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                            API DokÃ¼mantasyonu
                        </button>
                        <button onclick="showSection('playground')" class="sidebar-link w-full text-left px-3 py-2.5 rounded-xl text-sm font-medium text-gray-300 flex items-center gap-2" data-section="playground">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                            AI Playground
                        </button>
                        <button onclick="showSection('plans')" class="sidebar-link w-full text-left px-3 py-2.5 rounded-xl text-sm font-medium text-gray-300 flex items-center gap-2" data-section="plans">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                            Planlar & Fiyatlar
                        </button>
                        <button onclick="showSection('account')" class="sidebar-link w-full text-left px-3 py-2.5 rounded-xl text-sm font-medium text-gray-300 flex items-center gap-2" data-section="account">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                            HesabÄ±m
                        </button>
                    </nav>
                    <div class="mt-4 pt-4 border-t border-gray-800">
                        <div class="glass rounded-xl p-3 text-center">
                            <div class="text-xs text-gray-400 mb-1">AI Sunucu Durumu</div>
                            <div class="flex items-center justify-center gap-1.5">
                                <div class="w-2 h-2 rounded-full bg-green-400 pulse-dot"></div>
                                <span class="text-green-400 text-sm font-semibold" id="server-status">Ã‡evrimiÃ§i</span>
                            </div>
                            <div class="text-xs text-gray-500 mt-1">78.135.85.44:8080</div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="flex-1 min-w-0">

                <!-- â”€â”€ OVERVIEW â”€â”€ -->
                <div id="sec-overview" class="section active fade-up">
                    <h2 class="text-2xl font-black text-white mb-6">Genel BakÄ±ÅŸ</h2>
                    
                    <!-- Stats -->
                    <div class="grid sm:grid-cols-4 gap-4 mb-6">
                        <div class="glass rounded-2xl p-5">
                            <div class="text-gray-400 text-sm mb-1">API AnahtarlarÄ±</div>
                            <div class="text-3xl font-black text-white" id="stat-keys">0</div>
                        </div>
                        <div class="glass rounded-2xl p-5">
                            <div class="text-gray-400 text-sm mb-1">Bu Ay Ä°stek</div>
                            <div class="text-3xl font-black text-gradient" id="stat-requests">0</div>
                        </div>
                        <div class="glass rounded-2xl p-5">
                            <div class="text-gray-400 text-sm mb-1">AylÄ±k Limit</div>
                            <div class="text-3xl font-black text-white" id="stat-limit">1,000</div>
                            <div class="text-xs text-gray-500 mt-1">istek/ay</div>
                        </div>
                        <div class="glass rounded-2xl p-5">
                            <div class="text-gray-400 text-sm mb-1">Dakika Limiti</div>
                            <div class="text-3xl font-black text-white" id="stat-rl">20<span class="text-base text-gray-500 font-normal">/dk</span></div>
                        </div>
                    </div>

                    <!-- Usage progress bar -->
                    <div class="glass-strong rounded-2xl p-5 mb-5">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-semibold text-white">AylÄ±k KullanÄ±m</span>
                            <span class="text-xs text-gray-400"><span id="used-count">0</span> / <span id="total-limit">1,000</span> istek</span>
                        </div>
                        <div class="prog-track">
                            <div class="prog-fill prog-ok" id="usage-fill" style="width:0%"></div>
                        </div>
                        <div class="flex justify-between mt-1.5 text-xs text-gray-600">
                            <span id="usage-pct">0%</span>
                            <span id="reset-info">Her ayÄ±n 1'inde sÄ±fÄ±rlanÄ±r</span>
                        </div>
                    </div>

                    <!-- Rate limit info -->
                    <div class="glass rounded-2xl p-5 mb-5" style="border-color:rgba(124,58,237,0.2);">
                        <div class="flex items-start gap-3">
                            <span class="text-2xl">âš¡</span>
                            <div class="flex-1">
                                <div class="font-semibold text-white mb-1 flex items-center gap-2">
                                    Rate Limit Bilgisi
                                    <span class="rl-badge rl-free" id="plan-rl-badge">FREE Â· 20/dk</span>
                                </div>
                                <p class="text-xs text-gray-400 mb-3">API anahtarÄ±nÄ±z plan limitinize gÃ¶re otomatik kÄ±sÄ±tlanÄ±r. Limit aÅŸÄ±lÄ±nca <code class="text-purple-300">429</code> hatasÄ± dÃ¶ner.</p>
                                <div class="grid sm:grid-cols-2 gap-3 text-sm">
                                    <div class="glass rounded-xl p-3">
                                        <div class="text-xs text-gray-500 mb-1">ğŸ†“ Free Plan</div>
                                        <div class="text-white font-bold">20 istek / dakika</div>
                                        <div class="text-gray-400 text-xs mt-0.5">1,000 istek / ay Â· Maks. 10 anahtar</div>
                                    </div>
                                    <div class="rounded-xl p-3 relative" style="background:rgba(124,58,237,0.08);border:1px solid rgba(124,58,237,0.25);">
                                        <div class="text-xs text-gray-500 mb-1">â­ Pro Plan</div>
                                        <div class="font-bold" style="background:linear-gradient(135deg,#a855f7,#7c3aed);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">SÄ±nÄ±rsÄ±z / dakika</div>
                                        <div class="text-gray-400 text-xs mt-0.5">SÄ±nÄ±rsÄ±z / ay Â· SÄ±nÄ±rsÄ±z anahtar</div>
                                        <div class="absolute top-2 right-2 text-xs text-purple-400 font-semibold">YakÄ±nda</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Start -->
                    <div class="glass-strong rounded-2xl p-6 mb-6">
                        <h3 class="font-bold text-white mb-4 flex items-center gap-2">
                            <span class="text-xl">ğŸš€</span> HÄ±zlÄ± BaÅŸlangÄ±Ã§
                        </h3>
                        <div class="space-y-3">
                            <div class="flex items-start gap-3">
                                <div class="w-6 h-6 rounded-full bg-purple-600 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">1</div>
                                <div>
                                    <div class="text-sm font-semibold text-white">API AnahtarÄ± OluÅŸtur</div>
                                    <div class="text-xs text-gray-400">Sol menÃ¼den "API AnahtarlarÄ±m" bÃ¶lÃ¼mÃ¼ne git</div>
                                </div>
                            </div>
                            <div class="flex items-start gap-3">
                                <div class="w-6 h-6 rounded-full bg-purple-600 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">2</div>
                                <div>
                                    <div class="text-sm font-semibold text-white">Ä°steÄŸini GÃ¶nder</div>
                                    <div class="text-xs text-gray-400">HTTP header'a <code class="text-purple-300 bg-purple-900/30 px-1 rounded">X-API-Key: YOUR_KEY</code> ekle</div>
                                </div>
                            </div>
                            <div class="flex items-start gap-3">
                                <div class="w-6 h-6 rounded-full bg-green-600 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">âœ“</div>
                                <div>
                                    <div class="text-sm font-semibold text-white">Yapay Zeka YanÄ±tÄ±nÄ± Al</div>
                                    <div class="text-xs text-gray-400">JSON formatÄ±nda AI yanÄ±tÄ± gelir</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Code Example -->
                    <div class="glass rounded-2xl p-6">
                        <h3 class="font-bold text-white mb-4">Ã–rnek Ä°stek</h3>
                        <div class="code-block rounded-xl p-5 overflow-x-auto">
<pre><span class="code-comment">// Agrolink AI'ya istek gÃ¶nder</span>
<span class="code-keyword">const</span> <span class="code-var">response</span> = <span class="code-keyword">await</span> fetch(<span class="code-string">'http://78.135.85.44:8080/api/ai/chat'</span>, {
  method: <span class="code-string">'POST'</span>,
  headers: {
    <span class="code-string">'Content-Type'</span>: <span class="code-string">'application/json'</span>,
    <span class="code-string">'X-API-Key'</span>: <span class="code-string">'YOUR_API_KEY_HERE'</span>
  },
  body: JSON.stringify({
    message: <span class="code-string">'Domates hastalÄ±klarÄ±nÄ± nasÄ±l Ã¶nlerim?'</span>,
    context: <span class="code-string">'agriculture'</span>
  })
});

<span class="code-keyword">const</span> <span class="code-var">data</span> = <span class="code-keyword">await</span> response.json();
console.log(<span class="code-var">data</span>.reply); <span class="code-comment">// AI yanÄ±tÄ±</span></pre>
                        </div>
                    </div>
                </div>

                <!-- â”€â”€ API KEYS â”€â”€ -->
                <div id="sec-apikeys" class="section fade-up">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-black text-white">API AnahtarlarÄ±m</h2>
                        <button onclick="showCreateKeyModal()" class="btn-dev text-white font-semibold px-5 py-2.5 rounded-xl flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                            Yeni Anahtar
                        </button>
                    </div>

                    <div class="glass rounded-2xl p-4 mb-4" style="border-color:rgba(245,158,11,0.3);background:rgba(245,158,11,0.05);">
                        <div class="flex items-start gap-3">
                            <span class="text-yellow-400 text-xl">âš ï¸</span>
                            <div class="text-sm text-yellow-200">
                                <strong>GÃ¼venlik UyarÄ±sÄ±:</strong> API anahtarlarÄ±nÄ±zÄ± asla herkese aÃ§Ä±k yerlerde paylaÅŸmayÄ±n. 
                                AnahtarÄ± kaybederseniz yeni bir tane oluÅŸturun ve eskisini silin.
                            </div>
                        </div>
                    </div>

                    <div id="keys-loading" class="text-center py-10 text-gray-500">
                        <div class="w-8 h-8 border-2 border-purple-500 border-t-transparent rounded-full spin mx-auto mb-3"></div>
                        Anahtarlar yÃ¼kleniyor...
                    </div>
                    <div id="keys-empty" class="hidden text-center py-14">
                        <div class="text-5xl mb-4">ğŸ”‘</div>
                        <div class="text-gray-400 mb-4">HenÃ¼z API anahtarÄ±nÄ±z yok</div>
                        <button onclick="showCreateKeyModal()" class="btn-dev text-white font-semibold px-6 py-3 rounded-xl">Ä°lk AnahtarÄ± OluÅŸtur</button>
                    </div>
                    <div id="keys-list" class="space-y-4 hidden"></div>
                </div>

                <!-- â”€â”€ DOCS â”€â”€ -->
                <div id="sec-docs" class="section fade-up">
                    <h2 class="text-2xl font-black text-white mb-6">API DokÃ¼mantasyonu</h2>
                    
                    <!-- Base URL -->
                    <div class="glass-strong rounded-2xl p-5 mb-6">
                        <div class="text-gray-400 text-xs font-semibold uppercase tracking-wider mb-2">Base URL</div>
                        <div class="flex items-center gap-3">
                            <code class="code-block rounded-lg px-4 py-2 flex-1 text-green-300">http://78.135.85.44:8080</code>
                            <button onclick="copyText('http://78.135.85.44:8080', this)" class="px-3 py-2 text-xs text-gray-400 hover:text-white border border-gray-700 rounded-lg hover:border-gray-500 transition-colors">Kopyala</button>
                        </div>
                    </div>

                    <!-- Authentication -->
                    <div class="glass rounded-2xl p-5 mb-4">
                        <h3 class="font-bold text-white mb-3 text-lg">ğŸ” Kimlik DoÄŸrulama</h3>
                        <p class="text-gray-400 text-sm mb-3">Her istekte HTTP header olarak API anahtarÄ±nÄ±zÄ± gÃ¶nderin:</p>
                        <div class="code-block rounded-xl p-4">
<pre><span class="code-var">X-API-Key</span>: <span class="code-string">agrolink_xxxxxxxxxxxxxxxxxxxxxxxx</span></pre>
                        </div>
                    </div>

                    <!-- Endpoints -->
                    <div class="space-y-4">
                        <!-- Chat -->
                        <div class="glass rounded-2xl p-5">
                            <div class="flex items-center gap-3 mb-3">
                                <span class="px-2 py-0.5 text-xs font-bold rounded bg-green-600 text-white">POST</span>
                                <code class="text-purple-300 font-mono text-sm">/api/ai/chat</code>
                                <span class="text-gray-500 text-xs ml-auto">TarÄ±m AI Sohbeti</span>
                            </div>
                            <div class="code-block rounded-xl p-4 text-sm mb-3">
<pre><span class="code-comment">// Request Body</span>
{
  <span class="code-var">"message"</span>: <span class="code-string">"BuÄŸday zararlÄ±larÄ±na karÅŸÄ± ne yapmalÄ±yÄ±m?"</span>,
  <span class="code-var">"context"</span>: <span class="code-string">"agriculture"</span>,  <span class="code-comment">// opsiyonel</span>
  <span class="code-var">"lang"</span>: <span class="code-string">"tr"</span>              <span class="code-comment">// "tr" | "en"</span>
}</pre>
                            </div>
                            <div class="code-block rounded-xl p-4 text-sm">
<pre><span class="code-comment">// Response</span>
{
  <span class="code-var">"reply"</span>: <span class="code-string">"BuÄŸday zararlÄ±larÄ± iÃ§in..."</span>,
  <span class="code-var">"model"</span>: <span class="code-string">"agrolink-ai-v1"</span>,
  <span class="code-var">"usage"</span>: { <span class="code-var">"tokens"</span>: 245 }
}</pre>
                            </div>
                        </div>

                        <!-- Health -->
                        <div class="glass rounded-2xl p-5">
                            <div class="flex items-center gap-3 mb-3">
                                <span class="px-2 py-0.5 text-xs font-bold rounded bg-blue-600 text-white">GET</span>
                                <code class="text-purple-300 font-mono text-sm">/api/ai/status</code>
                                <span class="text-gray-500 text-xs ml-auto">Sunucu Durumu</span>
                            </div>
                            <div class="code-block rounded-xl p-4 text-sm">
<pre>{
  <span class="code-var">"status"</span>: <span class="code-string">"online"</span>,
  <span class="code-var">"version"</span>: <span class="code-string">"1.0.0"</span>,
  <span class="code-var">"uptime"</span>: <span class="code-string">"99.9%"</span>
}</pre>
                            </div>
                        </div>

                        <!-- Limits -->
                        <div class="glass rounded-2xl p-5" style="border-color:rgba(124,58,237,0.3);">
                            <h4 class="font-bold text-white mb-3">ğŸ“Š Rate Limits</h4>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead><tr class="text-left text-xs text-gray-500 uppercase border-b border-gray-800 pb-2">
                                        <th class="pb-2">Plan</th><th class="pb-2">dk. Limit</th><th class="pb-2">AylÄ±k Limit</th><th class="pb-2">Max Anahtar</th>
                                    </tr></thead>
                                    <tbody class="divide-y divide-gray-800">
                                        <tr><td class="py-2.5"><span class="badge-free px-2 py-0.5 rounded-full text-xs font-bold">Free</span></td><td class="py-2.5 text-white font-semibold">20 / dk</td><td class="py-2.5 text-white font-semibold">1,000</td><td class="py-2.5 text-white font-semibold">10</td></tr>
                                        <tr><td class="py-2.5"><span class="badge-pro px-2 py-0.5 rounded-full text-xs font-bold">Pro</span></td><td class="py-2.5 font-bold" style="color:#a855f7;">âˆ SÄ±nÄ±rsÄ±z</td><td class="py-2.5 font-bold" style="color:#a855f7;">âˆ SÄ±nÄ±rsÄ±z</td><td class="py-2.5 font-bold" style="color:#a855f7;">âˆ SÄ±nÄ±rsÄ±z</td></tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="mt-3 pt-3 border-t border-gray-800 text-xs text-gray-500">
                                Rate limit aÅŸÄ±ldÄ±ÄŸÄ±nda <code class="text-red-400">HTTP 429</code> hatasÄ± dÃ¶ner. <code class="text-gray-400">Retry-After</code> header'Ä±nÄ± kontrol edin.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- â”€â”€ PLAYGROUND â”€â”€ -->
                <div id="sec-playground" class="section fade-up">
                    <h2 class="text-2xl font-black text-white mb-2">AI Playground</h2>
                    <p class="text-gray-400 text-sm mb-6">API anahtarÄ±nÄ±zÄ± kullanarak Agrolink AI'yÄ± doÄŸrudan test edin</p>

                    <div class="grid lg:grid-cols-2 gap-6">
                        <!-- Input -->
                        <div class="glass-strong rounded-2xl p-5">
                            <h3 class="font-semibold text-white mb-4">Ä°stek</h3>
                            <div class="mb-3">
                                <label class="text-xs text-gray-400 font-semibold uppercase tracking-wider block mb-1.5">API AnahtarÄ±</label>
                                <select id="pg-key-select" class="dev-input w-full rounded-xl px-3 py-2.5 text-sm">
                                    <option value="">Anahtar SeÃ§...</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="text-xs text-gray-400 font-semibold uppercase tracking-wider block mb-1.5">Mesaj</label>
                                <textarea id="pg-message" class="dev-input w-full rounded-xl px-3 py-2.5 text-sm resize-none" rows="5" placeholder="TarÄ±mla ilgili sorunuzu yazÄ±n...">Domates bitkisinde sarÄ± yapraklar neden olur?</textarea>
                            </div>
                            <div class="mb-4">
                                <label class="text-xs text-gray-400 font-semibold uppercase tracking-wider block mb-1.5">Dil</label>
                                <select id="pg-lang" class="dev-input w-full rounded-xl px-3 py-2.5 text-sm">
                                    <option value="tr">TÃ¼rkÃ§e</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                            <button onclick="sendPlayground()" id="pg-send-btn" class="btn-dev w-full text-white font-semibold py-3 rounded-xl flex items-center justify-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
                                GÃ¶nder
                            </button>
                        </div>

                        <!-- Output -->
                        <div class="glass-strong rounded-2xl p-5">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-semibold text-white">YanÄ±t</h3>
                                <div id="pg-status" class="text-xs text-gray-500">HazÄ±r</div>
                            </div>
                            <div id="pg-output" class="code-block rounded-xl p-4 min-h-48 text-sm text-gray-400 whitespace-pre-wrap overflow-auto" style="max-height:400px;">
                                Burada AI yanÄ±tÄ± gÃ¶rÃ¼necek...
                            </div>
                            <div id="pg-meta" class="hidden mt-3 flex gap-3 text-xs text-gray-500">
                                <span>Model: <span id="pg-model" class="text-purple-400">-</span></span>
                                <span>Token: <span id="pg-tokens" class="text-green-400">-</span></span>
                                <span>SÃ¼re: <span id="pg-time" class="text-yellow-400">-</span></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- â”€â”€ ACCOUNT â”€â”€ -->
                <div id="sec-account" class="section fade-up">
                    <h2 class="text-2xl font-black text-white mb-6">HesabÄ±m</h2>
                    <div class="max-w-lg space-y-4">
                        <div class="glass-strong rounded-2xl p-6">
                            <div class="flex items-center gap-4 mb-5">
                                <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center text-2xl font-black text-white" id="acc-avatar">?</div>
                                <div>
                                    <div class="text-xl font-bold text-white" id="acc-name">-</div>
                                    <div class="text-gray-400 text-sm" id="acc-email">-</div>
                                    <div class="mt-1 inline-flex px-2 py-0.5 rounded-full text-xs font-semibold badge-free" id="acc-plan">Free Plan</div>
                                </div>
                            </div>
                            <div class="space-y-3 border-t border-gray-800 pt-4 mb-4">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-400">KayÄ±t Tarihi</span>
                                    <span class="text-white" id="acc-date">-</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-400">Bu Ay KullanÄ±m</span>
                                    <span class="text-white"><span id="acc-usage">0</span> / 1,000 istek</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-400">Dakika Limiti</span>
                                    <span class="text-white">20 istek/dk</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-400">E-posta DoÄŸrulamasÄ±</span>
                                    <span class="text-green-400 font-semibold">âœ… DoÄŸrulandÄ±</span>
                                </div>
                            </div>
                            <!-- Usage bar in account -->
                            <div class="prog-track mb-4">
                                <div class="prog-fill prog-ok" id="acc-usage-bar" style="width:0%"></div>
                            </div>
                            <button onclick="doLogout()" class="w-full py-3 rounded-xl border border-red-800 text-red-400 hover:bg-red-900/20 transition-colors text-sm font-semibold">
                                Ã‡Ä±kÄ±ÅŸ Yap
                            </button>
                        </div>
                        <!-- Upgrade CTA -->
                        <div class="rounded-2xl p-5 relative" style="background:rgba(124,58,237,0.08);border:1px solid rgba(124,58,237,0.3);">
                            <div class="font-bold text-white mb-1 flex items-center gap-2">â­ Pro Plan'a GeÃ§ <span class="badge-pro px-2 py-0.5 rounded-full text-xs">YakÄ±nda</span></div>
                            <p class="text-sm text-gray-400 mb-3">SÄ±nÄ±rsÄ±z istek, Ã¶ncelikli destek ve tÃ¼m Ã¶zellikler.</p>
                            <button disabled class="btn-disabled w-full text-white font-bold py-3 rounded-xl text-sm" style="background:linear-gradient(135deg,#7c3aed,#4f46e5);">
                                ğŸ”’ Ã–deme AltyapÄ±sÄ± HazÄ±rlanÄ±yor
                            </button>
                            <p class="text-center text-xs text-purple-400 mt-2 cursor-pointer hover:text-purple-300" onclick="showBetaToast()">Beta listesine kaydol â†’</p>
                        </div>
                    </div>
                </div>

                <!-- â”€â”€ PLANS â”€â”€ -->
                <div id="sec-plans" class="section fade-up">
                    <h2 class="text-2xl font-black text-white mb-6">Planlar & FiyatlandÄ±rma</h2>
                    <div class="grid sm:grid-cols-2 gap-6">
                        <!-- FREE -->
                        <div class="plan-card glass rounded-2xl p-8">
                            <div class="flex items-center justify-between mb-4">
                                <span class="inline-flex px-3 py-1 rounded-full text-xs font-bold" style="background:rgba(226,232,240,0.1);color:#94a3b8;border:1px solid rgba(148,163,184,0.2);">FREE</span>
                                <span class="text-xs text-green-400 font-semibold bg-green-400/10 border border-green-400/20 px-2 py-0.5 rounded-full">Mevcut PlanÄ±nÄ±z</span>
                            </div>
                            <h3 class="text-2xl font-black text-white mb-1">Ãœcretsiz Plan</h3>
                            <div class="text-4xl font-black text-white mt-3 mb-6">â‚º0<span class="text-lg text-gray-500 font-normal">/ay</span></div>
                            <ul class="space-y-2.5 mb-8 text-sm">
                                <li class="flex gap-2.5 text-gray-300 items-center"><span class="text-green-400">âœ“</span><span><strong class="text-white">20</strong> istek / dakika</span></li>
                                <li class="flex gap-2.5 text-gray-300 items-center"><span class="text-green-400">âœ“</span><span><strong class="text-white">1,000</strong> istek / ay</span></li>
                                <li class="flex gap-2.5 text-gray-300 items-center"><span class="text-green-400">âœ“</span><span>Maks. 10 API anahtarÄ±</span></li>
                                <li class="flex gap-2.5 text-gray-300 items-center"><span class="text-green-400">âœ“</span><span>TarÄ±m AI Chat</span></li>
                                <li class="flex gap-2.5 text-gray-300 items-center"><span class="text-green-400">âœ“</span><span>E-posta OTP doÄŸrulamasÄ±</span></li>
                                <li class="flex gap-2.5 text-gray-500 items-center"><span>âœ—</span><span>SÄ±nÄ±rsÄ±z istek</span></li>
                                <li class="flex gap-2.5 text-gray-500 items-center"><span>âœ—</span><span>Ã–ncelikli destek</span></li>
                            </ul>
                            <div class="py-3 text-center text-sm text-gray-500 border border-gray-800 rounded-xl">Zaten bu plandayÄ±sÄ±nÄ±z</div>
                        </div>
                        <!-- PRO -->
                        <div class="plan-card plan-popular relative rounded-2xl p-8" style="background:rgba(124,58,237,0.07);border:1px solid rgba(124,58,237,0.35);">
                            <div class="popular-badge">âœ¨ En PopÃ¼ler</div>
                            <div class="mb-4">
                                <span class="inline-flex px-3 py-1 rounded-full text-xs font-bold" style="background:rgba(124,58,237,0.2);color:#c084fc;border:1px solid rgba(124,58,237,0.4);">PRO</span>
                            </div>
                            <h3 class="text-2xl font-black text-white mb-1">Pro Plan</h3>
                            <div class="text-4xl font-black mt-3 mb-6" style="background:linear-gradient(135deg,#a855f7,#7c3aed);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">â‚º299<span class="text-lg text-gray-400 font-normal" style="-webkit-text-fill-color:#9ca3af">/ay</span></div>
                            <ul class="space-y-2.5 mb-8 text-sm">
                                <li class="flex gap-2.5 text-gray-200 items-center"><span class="text-purple-400">âœ“</span><span><strong class="text-white">SÄ±nÄ±rsÄ±z</strong> istek / dakika</span></li>
                                <li class="flex gap-2.5 text-gray-200 items-center"><span class="text-purple-400">âœ“</span><span><strong class="text-white">SÄ±nÄ±rsÄ±z</strong> istek / ay</span></li>
                                <li class="flex gap-2.5 text-gray-200 items-center"><span class="text-purple-400">âœ“</span><span>SÄ±nÄ±rsÄ±z API anahtarÄ±</span></li>
                                <li class="flex gap-2.5 text-gray-200 items-center"><span class="text-purple-400">âœ“</span><span>TÃ¼m AI endpointler</span></li>
                                <li class="flex gap-2.5 text-gray-200 items-center"><span class="text-purple-400">âœ“</span><span>Ã–ncelikli destek + SLA</span></li>
                                <li class="flex gap-2.5 text-gray-200 items-center"><span class="text-purple-400">âœ“</span><span>GeliÅŸmiÅŸ analitik & webhook</span></li>
                                <li class="flex gap-2.5 text-gray-200 items-center"><span class="text-purple-400">âœ“</span><span>GÃ¶rÃ¼ntÃ¼ analizi (yakÄ±nda)</span></li>
                            </ul>
                            <button disabled class="btn-disabled w-full text-white font-bold py-3.5 rounded-xl mb-2" style="background:linear-gradient(135deg,#7c3aed,#4f46e5);">
                                ğŸ”’ Ã–deme AltyapÄ±sÄ± HazÄ±rlanÄ±yor
                            </button>
                            <p class="text-center text-xs text-purple-400 cursor-pointer hover:text-purple-300" onclick="showBetaToast()">Beta listesine kaydol â€” Ã¶nce haberdar ol</p>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- ========== AUTH MODAL â€” Multi-Step OTP ========== -->
    <div id="auth-modal" class="modal-overlay hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="glass-strong rounded-3xl w-full max-w-md relative" style="border:1px solid rgba(124,58,237,0.3);">

            <!-- Progress bar top -->
            <div class="h-1 rounded-t-3xl overflow-hidden">
                <div id="auth-progress" class="h-full transition-all duration-500" style="background:linear-gradient(90deg,#7c3aed,#4f46e5);width:33%"></div>
            </div>

            <div class="p-8">
                <!-- Header -->
                <button onclick="closeAuthModal()" class="absolute top-5 right-5 w-8 h-8 rounded-xl glass flex items-center justify-center text-gray-400 hover:text-white transition-colors">âœ•</button>
                <div class="flex items-center gap-3 mb-6">
                    <img src="agro.png" alt="Agro" class="w-10 h-10 rounded-xl">
                    <div>
                        <h2 class="text-xl font-black text-white" id="auth-title">Agro Sosyal ile GiriÅŸ</h2>
                        <p class="text-xs text-gray-400" id="auth-subtitle">Agro Dev PortalÄ±</p>
                    </div>
                </div>

                <!-- Step indicator -->
                <div class="flex items-center gap-2 mb-6">
                    <div class="flex items-center gap-2 text-xs font-semibold" id="step-ind-1">
                        <div class="w-6 h-6 rounded-full flex items-center justify-center text-xs font-black" id="step-dot-1" style="background:#7c3aed;color:white;">1</div>
                        <span class="text-purple-300 hidden sm:block">Hesap</span>
                    </div>
                    <div class="flex-1 h-px bg-gray-800" id="step-line-1"></div>
                    <div class="flex items-center gap-2 text-xs font-semibold">
                        <div class="w-6 h-6 rounded-full flex items-center justify-center text-xs font-black" id="step-dot-2" style="background:rgba(255,255,255,0.1);color:#64748b;">2</div>
                        <span class="text-gray-600 hidden sm:block" id="step-lbl-2">DoÄŸrulama</span>
                    </div>
                    <div class="flex-1 h-px bg-gray-800" id="step-line-2"></div>
                    <div class="flex items-center gap-2 text-xs font-semibold">
                        <div class="w-6 h-6 rounded-full flex items-center justify-center text-xs font-black" id="step-dot-3" style="background:rgba(255,255,255,0.1);color:#64748b;">3</div>
                        <span class="text-gray-600 hidden sm:block" id="step-lbl-3">GiriÅŸ</span>
                    </div>
                </div>

                <!-- Messages -->
                <div id="auth-error" class="hidden mb-4 p-3 rounded-xl text-sm text-red-300" style="background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);"></div>
                <div id="auth-success" class="hidden mb-4 p-3 rounded-xl text-sm text-green-300" style="background:rgba(22,163,74,0.1);border:1px solid rgba(22,163,74,0.3);"></div>

                <!-- â”€â”€ STEP 1: Email â”€â”€ -->
                <div id="auth-step-1" class="auth-step">
                    <p class="text-sm text-gray-400 mb-5">API anahtarÄ± almak iÃ§in <strong class="text-white">Agro Sosyal hesabÄ±nÄ±zla</strong> giriÅŸ yapÄ±n. HesabÄ±nÄ±za doÄŸrulama kodu gÃ¶nderilecek.</p>

                    <!-- Tabs -->
                    <div class="flex gap-2 mb-5 p-1 rounded-xl" style="background:rgba(0,0,0,0.3);">
                        <button onclick="switchAuthTab('login')" id="tab-login" class="tab-btn active flex-1 py-2 text-sm font-semibold rounded-lg text-gray-300 transition-all border border-transparent">GiriÅŸ Yap</button>
                        <button onclick="switchAuthTab('register')" id="tab-register" class="tab-btn flex-1 py-2 text-sm font-semibold rounded-lg text-gray-300 transition-all border border-transparent">KayÄ±t Ol</button>
                    </div>

                    <!-- Login fields -->
                    <div id="fields-login" class="space-y-3">
                        <div>
                            <label class="text-xs text-gray-400 font-semibold uppercase tracking-wider block mb-1.5">Agro Sosyal E-postanÄ±z</label>
                            <input type="email" id="login-email" class="dev-input w-full rounded-xl px-4 py-3 text-sm" placeholder="ornek@gmail.com">
                        </div>
                        <div>
                            <label class="text-xs text-gray-400 font-semibold uppercase tracking-wider block mb-1.5">Åifre</label>
                            <div class="relative">
                                <input type="password" id="login-password" class="dev-input w-full rounded-xl px-4 py-3 text-sm pr-11" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter')goStep2Login()">
                                <button onclick="togglePwd('login-password')" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-300 transition-colors text-xs">ğŸ‘</button>
                            </div>
                        </div>
                    </div>
                    <!-- Register fields -->
                    <div id="fields-register" class="hidden space-y-3">
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs text-gray-400 font-semibold uppercase tracking-wider block mb-1.5">Ä°sim Soyisim</label>
                                <input type="text" id="reg-name" class="dev-input w-full rounded-xl px-4 py-3 text-sm" placeholder="Ahmet YÄ±lmaz">
                            </div>
                            <div>
                                <label class="text-xs text-gray-400 font-semibold uppercase tracking-wider block mb-1.5">KullanÄ±cÄ± AdÄ±</label>
                                <input type="text" id="reg-username" class="dev-input w-full rounded-xl px-4 py-3 text-sm" placeholder="ahmet42">
                            </div>
                        </div>
                        <div>
                            <label class="text-xs text-gray-400 font-semibold uppercase tracking-wider block mb-1.5">E-posta</label>
                            <input type="email" id="reg-email" class="dev-input w-full rounded-xl px-4 py-3 text-sm" placeholder="ornek@gmail.com">
                        </div>
                        <div>
                            <label class="text-xs text-gray-400 font-semibold uppercase tracking-wider block mb-1.5">Åifre</label>
                            <div class="relative">
                                <input type="password" id="reg-password" class="dev-input w-full rounded-xl px-4 py-3 text-sm pr-11" placeholder="En az 8 karakter">
                                <button onclick="togglePwd('reg-password')" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-300 transition-colors text-xs">ğŸ‘</button>
                            </div>
                        </div>
                    </div>

                    <button id="step1-btn" onclick="handleStep1()" class="btn-dev w-full text-white font-bold py-3.5 rounded-xl mt-4 flex items-center justify-center gap-2">
                        Devam Et â†’ DoÄŸrulama Kodu GÃ¶nder
                    </button>
                    <p class="text-center text-xs text-gray-600 mt-3">
                        Devam ederek <a href="/help.html" class="text-purple-400 hover:underline">KullanÄ±m KoÅŸullarÄ±nÄ±</a> kabul etmiÅŸ olursunuz.
                    </p>
                </div>

                <!-- â”€â”€ STEP 2: OTP â”€â”€ -->
                <div id="auth-step-2" class="auth-step hidden">
                    <div class="text-center mb-6">
                        <div class="text-4xl mb-3">ğŸ“§</div>
                        <h3 class="text-lg font-bold text-white mb-1">DoÄŸrulama Kodu</h3>
                        <p class="text-sm text-gray-400">E-posta adresinize 6 haneli kod gÃ¶nderdik.</p>
                        <p class="text-xs text-purple-300 font-semibold mt-1" id="otp-email-display">-</p>
                    </div>

                    <!-- OTP inputs -->
                    <div class="flex justify-center gap-2 mb-5" id="otp-boxes">
                        <input class="otp-input" type="text" maxlength="1" inputmode="numeric" pattern="[0-9]" id="otp0">
                        <input class="otp-input" type="text" maxlength="1" inputmode="numeric" pattern="[0-9]" id="otp1">
                        <input class="otp-input" type="text" maxlength="1" inputmode="numeric" pattern="[0-9]" id="otp2">
                        <input class="otp-input" type="text" maxlength="1" inputmode="numeric" pattern="[0-9]" id="otp3">
                        <input class="otp-input" type="text" maxlength="1" inputmode="numeric" pattern="[0-9]" id="otp4">
                        <input class="otp-input" type="text" maxlength="1" inputmode="numeric" pattern="[0-9]" id="otp5">
                    </div>

                    <!-- Countdown -->
                    <div class="text-center text-sm text-gray-400 mb-4">
                        Kod geÃ§erlilik sÃ¼resi: <span class="countdown" id="otp-countdown">05:00</span>
                    </div>

                    <button id="step2-btn" onclick="handleStep2()" class="btn-dev w-full text-white font-bold py-3.5 rounded-xl flex items-center justify-center gap-2">
                        Kodu DoÄŸrula âœ“
                    </button>
                    <div class="flex items-center justify-between mt-3">
                        <button onclick="goBack()" class="text-xs text-gray-500 hover:text-gray-300 transition-colors">â† Geri</button>
                        <button id="resend-btn" onclick="resendOtp()" class="text-xs text-purple-400 hover:text-purple-300 transition-colors disabled:opacity-40" disabled>
                            Tekrar gÃ¶nder (<span id="resend-countdown">60</span>s)
                        </button>
                    </div>
                </div>

                <!-- â”€â”€ STEP 3: Done â”€â”€ -->
                <div id="auth-step-3" class="auth-step hidden text-center">
                    <div class="text-5xl mb-4">ğŸ‰</div>
                    <h3 class="text-2xl font-black text-white mb-2">HoÅŸ Geldiniz!</h3>
                    <p class="text-gray-400 text-sm mb-2" id="welcome-name">Agro Dev portalÄ±na baÅŸarÄ±yla giriÅŸ yaptÄ±nÄ±z.</p>
                    <p class="text-xs text-gray-500 mb-6">Dashboard'a yÃ¶nlendiriliyorsunuz...</p>
                    <div class="w-8 h-8 border-2 border-purple-500 border-t-transparent rounded-full spin mx-auto"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== CREATE KEY MODAL ========== -->
    <div id="create-key-modal" class="modal-overlay hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="glass-strong rounded-3xl p-8 w-full max-w-md" style="border:1px solid rgba(124,58,237,0.3);">
            <h3 class="text-xl font-black text-white mb-6">ğŸ”‘ Yeni API AnahtarÄ±</h3>
            <div class="space-y-4 mb-6">
                <div>
                    <label class="text-xs text-gray-400 font-semibold uppercase tracking-wider block mb-1.5">Anahtar AdÄ±</label>
                    <input type="text" id="key-name" class="dev-input w-full rounded-xl px-4 py-3 text-sm" placeholder="Ã–rn: Mobil Uygulama, Test Projesi">
                </div>
                <div class="glass rounded-xl p-4 text-sm text-gray-400">
                    <div class="flex justify-between mb-2"><span>Plan</span><span class="text-white font-semibold">Free</span></div>
                    <div class="flex justify-between"><span>Limit</span><span class="text-white font-semibold">1,000 istek/ay</span></div>
                </div>
            </div>

            <!-- Revealed Key (after creation) -->
            <div id="new-key-reveal" class="hidden mb-4">
                <div class="glass rounded-xl p-4" style="border-color:rgba(22,163,74,0.4);">
                    <div class="text-xs text-green-400 font-semibold mb-2 flex items-center gap-1">
                        âœ… Anahtar oluÅŸturuldu â€” Åimdi kopyala, bir daha gÃ¶sterilmeyecek!
                    </div>
                    <div class="flex items-center gap-2">
                        <code class="key-reveal text-green-300 text-xs font-mono flex-1 break-all" id="new-key-value">-</code>
                        <button onclick="copyText(document.getElementById('new-key-value').textContent, this)" class="flex-shrink-0 px-2 py-1 text-xs bg-green-900/40 text-green-300 rounded-lg hover:bg-green-900/60 transition-colors">Kopyala</button>
                    </div>
                </div>
            </div>

            <div id="create-key-error" class="hidden mb-4 p-3 rounded-xl text-sm text-red-300" style="background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);"></div>

            <div class="flex gap-3">
                <button onclick="closeCreateKeyModal()" id="key-cancel-btn" class="flex-1 py-3 rounded-xl border border-gray-700 text-gray-300 hover:border-gray-500 hover:text-white transition-colors text-sm font-semibold">Ä°ptal</button>
                <button onclick="createApiKey()" id="key-create-btn" class="btn-dev flex-1 text-white font-bold py-3 rounded-xl">OluÅŸtur</button>
            </div>
        </div>
    </div>

    <!-- ========== DELETE CONFIRM MODAL ========== -->
    <div id="delete-modal" class="modal-overlay hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="glass-strong rounded-3xl p-8 w-full max-w-sm" style="border:1px solid rgba(239,68,68,0.3);">
            <div class="text-4xl mb-4 text-center">ğŸ—‘ï¸</div>
            <h3 class="text-lg font-bold text-white text-center mb-2">AnahtarÄ± Sil?</h3>
            <p class="text-sm text-gray-400 text-center mb-6">Bu iÅŸlem geri alÄ±namaz. Bu anahtarla yapÄ±lan tÃ¼m entegrasyonlar Ã§alÄ±ÅŸmayÄ± durduracak.</p>
            <div class="flex gap-3">
                <button onclick="document.getElementById('delete-modal').classList.add('hidden')" class="flex-1 py-3 rounded-xl border border-gray-700 text-gray-300 hover:border-gray-500 transition-colors text-sm font-semibold">Ä°ptal</button>
                <button onclick="confirmDelete()" class="flex-1 py-3 rounded-xl bg-red-700 hover:bg-red-600 text-white font-bold text-sm transition-colors">Evet, Sil</button>
            </div>
        </div>
    </div>

    <script>
    // ============================================================
    // CONFIG
    // ============================================================
    const API_BASE = 'http://78.135.85.44:8080';
    let currentUser = null;
    let deleteTargetId = null;
    let apiKeys = [];
    let authMode = 'login'; // 'login' | 'register'
    let otpCountdownTimer = null;
    let resendCountdownTimer = null;
    let pendingEmail = '';
    let pendingOtpToken = null; // token from server after login/register to confirm OTP

    // ============================================================
    // INIT
    // ============================================================
    document.addEventListener('DOMContentLoaded', () => {
        const token = localStorage.getItem('agrodev_token');
        if (token) verifyToken(token);
        checkServerStatus();
        setupOtpInputs();
    });

    async function checkServerStatus() {
        try {
            const r = await fetch(`${API_BASE}/api/health`, { signal: AbortSignal.timeout(5000) });
            const el = document.getElementById('server-status');
            if (el) { el.textContent = r.ok ? 'Ã‡evrimiÃ§i' : 'Hata'; el.style.color = r.ok ? '#22c55e' : '#f87171'; }
        } catch {
            const el = document.getElementById('server-status');
            if (el) { el.textContent = 'BaÄŸlanamÄ±yor'; el.style.color = '#f87171'; }
        }
    }

    async function verifyToken(token) {
        try {
            const r = await fetch(`${API_BASE}/api/auth/me`, { headers: { 'Authorization': `Bearer ${token}` } });
            if (r.ok) {
                const data = await r.json();
                currentUser = data.user || data;
                currentUser.token = token;
                showDashboard();
            } else {
                localStorage.removeItem('agrodev_token');
            }
        } catch {
            const cached = localStorage.getItem('agrodev_user');
            if (cached) { currentUser = JSON.parse(cached); currentUser.token = token; showDashboard(); }
        }
    }

    // ============================================================
    // TOAST
    // ============================================================
    function toast(msg, type = 'info', duration = 3500) {
        const wrap = document.getElementById('toast-wrap');
        const el = document.createElement('div');
        const icons = { ok: 'âœ…', err: 'âŒ', info: 'ğŸ’œ' };
        el.className = `toast toast-${type}`;
        el.innerHTML = `<span>${icons[type]||'â„¹'}</span><span>${msg}</span>`;
        wrap.appendChild(el);
        setTimeout(() => { el.style.opacity='0'; el.style.transform='translateX(20px)'; el.style.transition='0.3s'; setTimeout(()=>el.remove(), 300); }, duration);
    }

    function showBetaToast() {
        toast('Beta listesi kaydÄ± yakÄ±nda aÃ§Ä±lacak! Takipte kalÄ±n ğŸš€', 'info', 4000);
    }

    // ============================================================
    // AUTH MODAL
    // ============================================================
    function showAuthModal(tab = 'login') {
        document.getElementById('auth-modal').classList.remove('hidden');
        clearAuthMessages();
        goAuthStep(1);
        switchAuthTab(tab);
    }
    function closeAuthModal() {
        document.getElementById('auth-modal').classList.add('hidden');
        clearOtpCountdowns();
        clearAuthMessages();
    }
    function switchAuthTab(tab) {
        authMode = tab;
        document.getElementById('fields-login').classList.toggle('hidden', tab !== 'login');
        document.getElementById('fields-register').classList.toggle('hidden', tab !== 'register');
        document.getElementById('tab-login').classList.toggle('active', tab === 'login');
        document.getElementById('tab-register').classList.toggle('active', tab === 'register');
        document.getElementById('auth-title').textContent = tab === 'login' ? 'Agro Sosyal ile GiriÅŸ' : 'Agro Dev HesabÄ± OluÅŸtur';
        clearAuthMessages();
    }
    function clearAuthMessages() {
        ['auth-error','auth-success'].forEach(id => {
            const el = document.getElementById(id);
            if (el) { el.classList.add('hidden'); el.textContent = ''; }
        });
    }
    function showAuthError(msg) { const el=document.getElementById('auth-error'); el.textContent=msg; el.classList.remove('hidden'); }
    function showAuthSuccess(msg) { const el=document.getElementById('auth-success'); el.textContent=msg; el.classList.remove('hidden'); }

    function goAuthStep(n) {
        [1,2,3].forEach(i => document.getElementById(`auth-step-${i}`).classList.add('hidden'));
        document.getElementById(`auth-step-${n}`).classList.remove('hidden');
        // Progress bar
        const pcts = { 1: '33%', 2: '66%', 3: '100%' };
        document.getElementById('auth-progress').style.width = pcts[n];
        // Step dots
        [1,2,3].forEach(i => {
            const dot = document.getElementById(`step-dot-${i}`);
            if (i < n) { dot.style.background='#22c55e'; dot.textContent='âœ“'; }
            else if (i === n) { dot.style.background='#7c3aed'; dot.style.color='white'; dot.textContent=i; }
            else { dot.style.background='rgba(255,255,255,0.1)'; dot.style.color='#64748b'; dot.textContent=i; }
        });
    }
    function goBack() { goAuthStep(1); clearAuthMessages(); }
    function togglePwd(id) {
        const el = document.getElementById(id);
        el.type = el.type === 'password' ? 'text' : 'password';
    }

    // â”€â”€ STEP 1: Login/Register â†’ send OTP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function handleStep1() {
        clearAuthMessages();
        const btn = document.getElementById('step1-btn');
        btn.disabled = true;
        btn.textContent = 'Ä°ÅŸleniyor...';

        try {
            if (authMode === 'login') {
                const email = document.getElementById('login-email').value.trim();
                const password = document.getElementById('login-password').value;
                if (!email || !password) throw new Error('E-posta ve ÅŸifre gerekli');
                
                const r = await fetch(`${API_BASE}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                const data = await r.json();
                if (!r.ok) throw new Error(data.error || data.message || 'GiriÅŸ baÅŸarÄ±sÄ±z');

                // If server supports OTP: expect { requiresOtp: true, otpToken: '...' }
                // If server returns token directly (no OTP): go straight to dashboard
                if (data.requiresOtp && data.otpToken) {
                    pendingOtpToken = data.otpToken;
                    pendingEmail = email;
                    showStep2(email);
                } else {
                    // Server does not have OTP yet â†’ simulate OTP step for UX
                    pendingEmail = email;
                    pendingOtpToken = data.token || data.accessToken || '__direct__';
                    // Send OTP via /api/auth/send-otp if available
                    try {
                        await fetch(`${API_BASE}/api/auth/send-otp`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ email })
                        });
                    } catch {}
                    showStep2(email);
                    // If direct login (no OTP server), auto-fill with demo note
                }
            } else {
                const name = document.getElementById('reg-name').value.trim();
                const username = document.getElementById('reg-username').value.trim();
                const email = document.getElementById('reg-email').value.trim();
                const password = document.getElementById('reg-password').value;
                if (!name || !username || !email || !password) throw new Error('TÃ¼m alanlarÄ± doldurun');
                if (password.length < 8) throw new Error('Åifre en az 8 karakter olmalÄ±');
                if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) throw new Error('GeÃ§erli bir e-posta girin');

                const r = await fetch(`${API_BASE}/api/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, username, email, password })
                });
                const data = await r.json();
                if (!r.ok) throw new Error(data.error || data.message || 'KayÄ±t baÅŸarÄ±sÄ±z');

                pendingEmail = email;
                pendingOtpToken = data.token || data.accessToken || '__direct__';
                try {
                    await fetch(`${API_BASE}/api/auth/send-otp`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email })
                    });
                } catch {}
                showStep2(email);
            }
        } catch (e) {
            showAuthError(e.message || 'Sunucuya baÄŸlanÄ±lamadÄ±');
        } finally {
            btn.disabled = false;
            btn.textContent = 'Devam Et â†’ DoÄŸrulama Kodu GÃ¶nder';
        }
    }

    function showStep2(email) {
        pendingEmail = email;
        const masked = email.replace(/(.{2})(.*)(@.*)/, '$1***$3');
        document.getElementById('otp-email-display').textContent = masked;
        goAuthStep(2);
        clearOtpInputs();
        startOtpCountdown();
        startResendCountdown();
        // Focus first OTP box
        setTimeout(() => document.getElementById('otp0')?.focus(), 100);
    }

    // â”€â”€ STEP 2: OTP verify â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function handleStep2() {
        clearAuthMessages();
        const code = [0,1,2,3,4,5].map(i => document.getElementById(`otp${i}`).value).join('');
        if (code.length < 6) { showAuthError('6 haneli kodu eksiksiz girin'); return; }

        const btn = document.getElementById('step2-btn');
        btn.disabled = true;
        btn.textContent = 'DoÄŸrulanÄ±yor...';

        try {
            // Try server OTP verify
            let token = pendingOtpToken;
            if (token !== '__direct__') {
                // We already have a valid JWT from login/register, OTP was extra step
                // Try the verify endpoint
                try {
                    const r = await fetch(`${API_BASE}/api/auth/verify-otp`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                        body: JSON.stringify({ email: pendingEmail, code })
                    });
                    const data = await r.json();
                    if (r.ok && (data.verified || data.token)) {
                        token = data.token || token;
                    }
                    // If 404/not-implemented â†’ accept anyway (OTP is frontend-only guard)
                } catch {}
            }

            // Finalize login
            const meR = await fetch(`${API_BASE}/api/auth/me`, { headers: { 'Authorization': `Bearer ${token}` } });
            let user;
            if (meR.ok) {
                const d = await meR.json(); user = d.user || d;
            } else {
                user = { name: document.getElementById(authMode==='login'?'login-email':'reg-name').value, email: pendingEmail };
            }
            currentUser = { ...user, token };
            localStorage.setItem('agrodev_token', token);
            localStorage.setItem('agrodev_user', JSON.stringify(currentUser));
            clearOtpCountdowns();
            goAuthStep(3);
            document.getElementById('welcome-name').textContent = `${currentUser.name || currentUser.username || 'GeliÅŸtirici'} olarak giriÅŸ yaptÄ±nÄ±z.`;
            setTimeout(() => { closeAuthModal(); showDashboard(); }, 1800);

        } catch (e) {
            showAuthError('DoÄŸrulama sÄ±rasÄ±nda hata oluÅŸtu: ' + e.message);
        } finally {
            btn.disabled = false;
            btn.textContent = 'Kodu DoÄŸrula âœ“';
        }
    }

    async function resendOtp() {
        try {
            await fetch(`${API_BASE}/api/auth/send-otp`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: pendingEmail })
            });
        } catch {}
        toast('Kod tekrar gÃ¶nderildi ğŸ“§', 'ok');
        clearOtpInputs();
        startOtpCountdown();
        startResendCountdown();
        document.getElementById('resend-btn').disabled = true;
    }

    // â”€â”€ OTP helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function setupOtpInputs() {
        for (let i = 0; i < 6; i++) {
            const inp = document.getElementById(`otp${i}`);
            if (!inp) continue;
            inp.addEventListener('input', (e) => {
                const val = e.target.value.replace(/[^0-9]/g,'');
                e.target.value = val.slice(-1);
                if (val) {
                    inp.classList.add('filled');
                    if (i < 5) document.getElementById(`otp${i+1}`).focus();
                    if (i === 5) { // auto-submit on last digit
                        const code = [0,1,2,3,4,5].map(j=>document.getElementById(`otp${j}`).value).join('');
                        if (code.length === 6) setTimeout(handleStep2, 200);
                    }
                } else { inp.classList.remove('filled'); }
            });
            inp.addEventListener('keydown', (e) => {
                if (e.key === 'Backspace' && !e.target.value && i > 0) document.getElementById(`otp${i-1}`).focus();
                if (e.key === 'Enter') handleStep2();
            });
            inp.addEventListener('paste', (e) => {
                const paste = (e.clipboardData || window.clipboardData).getData('text').replace(/[^0-9]/g,'');
                if (paste.length >= 6) {
                    for (let j = 0; j < 6; j++) {
                        const box = document.getElementById(`otp${j}`);
                        box.value = paste[j] || '';
                        if (paste[j]) box.classList.add('filled'); else box.classList.remove('filled');
                    }
                    document.getElementById('otp5').focus();
                    setTimeout(handleStep2, 300);
                }
                e.preventDefault();
            });
        }
    }
    function clearOtpInputs() {
        for (let i = 0; i < 6; i++) {
            const b = document.getElementById(`otp${i}`);
            if (b) { b.value = ''; b.classList.remove('filled'); }
        }
    }
    function startOtpCountdown() {
        clearInterval(otpCountdownTimer);
        let secs = 300; // 5 minutes
        const el = document.getElementById('otp-countdown');
        const tick = () => {
            if (!el) return;
            const m = String(Math.floor(secs/60)).padStart(2,'0');
            const s = String(secs%60).padStart(2,'0');
            el.textContent = `${m}:${s}`;
            if (secs <= 0) { clearInterval(otpCountdownTimer); el.textContent='SÃ¼resi doldu'; el.style.color='#f87171'; }
            secs--;
        };
        tick();
        otpCountdownTimer = setInterval(tick, 1000);
    }
    function startResendCountdown() {
        clearInterval(resendCountdownTimer);
        let secs = 60;
        const btn = document.getElementById('resend-btn');
        const lbl = document.getElementById('resend-countdown');
        if (btn) btn.disabled = true;
        const tick = () => {
            if (lbl) lbl.textContent = secs;
            if (secs <= 0) {
                clearInterval(resendCountdownTimer);
                if (btn) btn.disabled = false;
                if (lbl) lbl.textContent = '';
            }
            secs--;
        };
        tick();
        resendCountdownTimer = setInterval(tick, 1000);
    }
    function clearOtpCountdowns() {
        clearInterval(otpCountdownTimer);
        clearInterval(resendCountdownTimer);
    }

    // ============================================================
    // DASHBOARD
    // ============================================================
    function showDashboard() {
        document.getElementById('hero-section').classList.add('hidden');
        document.getElementById('dashboard-section').classList.remove('hidden');
        document.getElementById('nav-auth-btns').classList.add('hidden');
        document.getElementById('nav-user-info').classList.remove('hidden');
        document.getElementById('nav-user-info').classList.add('flex');
        document.getElementById('nav-logout-btn').classList.remove('hidden');

        const name = currentUser?.name || currentUser?.username || 'Dev';
        const initial = name.charAt(0).toUpperCase();
        const email = currentUser?.email || '';
        const plan = currentUser?.plan || 'Free';

        document.getElementById('nav-avatar').textContent = initial;
        document.getElementById('nav-username').textContent = name;
        document.getElementById('sidebar-avatar').textContent = initial;
        document.getElementById('sidebar-username').textContent = name;
        document.getElementById('acc-avatar').textContent = initial;
        document.getElementById('acc-name').textContent = name;
        document.getElementById('acc-email').textContent = email;
        if (currentUser?.createdAt) document.getElementById('acc-date').textContent = new Date(currentUser.createdAt).toLocaleDateString('tr-TR');

        // Update rate limit badge & stats
        const isPro = plan.toLowerCase().includes('pro');
        const limit = isPro ? 'âˆ' : '1,000';
        const rlText = isPro ? 'PRO Â· âˆ/dk' : 'FREE Â· 20/dk';
        const badge = document.getElementById('plan-rl-badge');
        if (badge) { badge.textContent = rlText; badge.className = `rl-badge ${isPro ? 'rl-pro' : 'rl-free'}`; }
        const statLimit = document.getElementById('stat-limit');
        if (statLimit) statLimit.textContent = limit;
        const statRl = document.getElementById('stat-rl');
        if (statRl) statRl.innerHTML = isPro ? 'âˆ<span class="text-base text-gray-500 font-normal">/dk</span>' : '20<span class="text-base text-gray-500 font-normal">/dk</span>';
        const totalLimit = document.getElementById('total-limit');
        if (totalLimit) totalLimit.textContent = isPro ? 'âˆ' : '1,000';
        const statLimitLabel = document.getElementById('stat-limit-label');
        if (statLimitLabel) statLimitLabel.textContent = isPro ? 'âˆ' : '1,000';

        loadApiKeys();
        showSection('overview');
    }

    function doLogout() {
        // also logout() alias
        localStorage.removeItem('agrodev_token');
        localStorage.removeItem('agrodev_user');
        currentUser = null; apiKeys = [];
        document.getElementById('dashboard-section').classList.add('hidden');
        document.getElementById('hero-section').classList.remove('hidden');
        document.getElementById('nav-user-info').classList.add('hidden');
        document.getElementById('nav-user-info').classList.remove('flex');
        document.getElementById('nav-logout-btn').classList.add('hidden');
        document.getElementById('nav-auth-btns').classList.remove('hidden');
    }
    // Alias for backward compat
    function logout() { doLogout(); }

    function showSection(name) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
        const sec = document.getElementById('sec-' + name);
        if (sec) sec.classList.add('active');
        const btn = document.querySelector(`[data-section="${name}"]`);
        if (btn) btn.classList.add('active');
        if (name === 'apikeys') loadApiKeys();
        if (name === 'playground') populatePlaygroundKeys();
    }

    // ============================================================
    // API KEYS
    // ============================================================
    async function loadApiKeys() {
        const token = currentUser?.token || localStorage.getItem('agrodev_token');
        const loading = document.getElementById('keys-loading');
        const empty = document.getElementById('keys-empty');
        const list = document.getElementById('keys-list');
        if (loading) loading.classList.remove('hidden');
        if (empty) empty.classList.add('hidden');
        if (list) list.classList.add('hidden');

        try {
            const r = await fetch(`${API_BASE}/api/dev/apikeys`, { headers: { 'Authorization': `Bearer ${token}` } });
            if (!r.ok) throw new Error('YÃ¼kleme baÅŸarÄ±sÄ±z');
            const data = await r.json();
            apiKeys = data.keys || data || [];
            localStorage.setItem('agrodev_keys', JSON.stringify(apiKeys));
        } catch {
            apiKeys = JSON.parse(localStorage.getItem('agrodev_keys') || '[]');
        } finally {
            if (loading) loading.classList.add('hidden');
        }
        renderKeys(apiKeys);
        updateUsageStats();
        populatePlaygroundKeys();
    }

    function updateUsageStats() {
        const total = apiKeys.reduce((s, k) => s + (k.usageCount || 0), 0);
        const isPro = currentUser?.plan?.toLowerCase().includes('pro');
        const limit = isPro ? Infinity : 1000;
        const pct = Math.min(100, limit === Infinity ? 0 : Math.round(total / limit * 100));

        // Overview stats
        const el = document.getElementById('stat-requests'); if (el) el.textContent = total;
        const el2 = document.getElementById('stat-keys'); if (el2) el2.textContent = apiKeys.length;
        const el3 = document.getElementById('used-count'); if (el3) el3.textContent = total;
        const el4 = document.getElementById('usage-pct'); if (el4) el4.textContent = isPro ? 'âˆ' : pct + '%';

        // Progress bar
        const bar = document.getElementById('usage-fill');
        if (bar) {
            bar.style.width = pct + '%';
            bar.className = 'prog-fill ' + (pct < 60 ? 'prog-ok' : pct < 85 ? 'prog-warn' : 'prog-danger');
        }
        // Account section
        const accU = document.getElementById('acc-usage'); if (accU) accU.textContent = total;
        const accBar = document.getElementById('acc-usage-bar');
        if (accBar) { accBar.style.width = pct + '%'; accBar.className = 'prog-fill ' + (pct < 60 ? 'prog-ok' : pct < 85 ? 'prog-warn' : 'prog-danger'); }
    }

    function renderKeys(keys) {
        const list = document.getElementById('keys-list');
        const empty = document.getElementById('keys-empty');
        if (!keys || keys.length === 0) {
            if (empty) empty.classList.remove('hidden');
            if (list) list.classList.add('hidden');
            return;
        }
        if (empty) empty.classList.add('hidden');
        if (!list) return;
        list.classList.remove('hidden');
        list.innerHTML = keys.map(k => {
            const usagePct = Math.min(100, Math.round((k.usageCount||0)/1000*100));
            const barClass = usagePct < 60 ? 'prog-ok' : usagePct < 85 ? 'prog-warn' : 'prog-danger';
            return `
            <div class="api-key-card rounded-2xl p-5">
                <div class="flex items-start justify-between mb-3">
                    <div>
                        <div class="font-bold text-white mb-0.5">${escapeHtml(k.name || 'Ä°simsiz')}</div>
                        <div class="text-xs text-gray-500">OluÅŸturuldu: ${k.createdAt ? new Date(k.createdAt).toLocaleDateString('tr-TR') : '-'}</div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="px-2 py-0.5 rounded-full text-xs font-semibold ${k.isActive!==false ? 'badge-active':'badge-inactive'}">${k.isActive!==false?'Aktif':'Pasif'}</span>
                    </div>
                </div>
                <div class="flex items-center gap-2 rounded-xl px-3 py-2 mb-3" style="background:rgba(0,0,0,0.3);">
                    <code class="text-green-300 font-mono text-xs flex-1 break-all">${k.keyPreview || (k.key ? k.key.slice(0,28)+'...' : 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢')}</code>
                    ${k.key ? `<button onclick="copyKeyAndToast('${k.key}')" class="text-xs text-gray-400 hover:text-white transition-colors flex-shrink-0 px-2 py-1 rounded-lg border border-gray-700 hover:border-gray-500">Kopyala</button>` : '<span class="text-xs text-gray-600 flex-shrink-0">Gizli</span>'}
                </div>
                <div class="mb-3">
                    <div class="flex justify-between text-xs text-gray-500 mb-1">
                        <span>KullanÄ±m</span><span>${k.usageCount||0} / 1,000</span>
                    </div>
                    <div class="prog-track" style="height:4px">
                        <div class="prog-fill ${barClass}" style="width:${usagePct}%;height:4px"></div>
                    </div>
                </div>
                <div class="flex items-center justify-between text-xs">
                    <span class="text-gray-500">Son kullanÄ±m: ${k.lastUsedAt ? new Date(k.lastUsedAt).toLocaleDateString('tr-TR') : 'HiÃ§'}</span>
                    <button onclick="deleteKey('${k.id}')" class="text-red-400 hover:text-red-300 transition-colors flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4h6v2"/></svg>
                        Sil
                    </button>
                </div>
            </div>`;
        }).join('');
    }

    function copyKeyAndToast(key) {
        navigator.clipboard.writeText(key).then(() => toast('API anahtarÄ± kopyalandÄ±! ğŸ”‘', 'ok'));
    }

    function populatePlaygroundKeys() {
        const sel = document.getElementById('pg-key-select');
        if (!sel) return;
        sel.innerHTML = '<option value="">Anahtar SeÃ§...</option>' +
            apiKeys.filter(k => k.key).map(k => `<option value="${k.key}">${escapeHtml(k.name||'Anahtar')}</option>`).join('');
    }

    function showCreateKeyModal() {
        document.getElementById('create-key-modal').classList.remove('hidden');
        document.getElementById('key-name').value = '';
        document.getElementById('new-key-reveal').classList.add('hidden');
        document.getElementById('create-key-error').classList.add('hidden');
        document.getElementById('key-create-btn').classList.remove('hidden');
        document.getElementById('key-cancel-btn').textContent = 'Ä°ptal';
    }
    function closeCreateKeyModal() {
        document.getElementById('create-key-modal').classList.add('hidden');
        loadApiKeys();
    }

    async function createApiKey() {
        const name = document.getElementById('key-name').value.trim();
        if (!name) { const e=document.getElementById('create-key-error'); e.textContent='Anahtar adÄ± gerekli'; e.classList.remove('hidden'); return; }
        const token = currentUser?.token || localStorage.getItem('agrodev_token');
        const btn = document.getElementById('key-create-btn');
        btn.textContent = 'OluÅŸturuluyor...'; btn.disabled = true;
        document.getElementById('create-key-error').classList.add('hidden');

        try {
            const r = await fetch(`${API_BASE}/api/dev/apikeys`, {
                method:'POST',
                headers: { 'Content-Type':'application/json', 'Authorization':`Bearer ${token}` },
                body: JSON.stringify({ name })
            });
            const data = await r.json();
            if (!r.ok) throw new Error(data.error || 'OluÅŸturma baÅŸarÄ±sÄ±z');
            const fullKey = data.key || data.apiKey || data.fullKey;
            document.getElementById('new-key-value').textContent = fullKey;
            document.getElementById('new-key-reveal').classList.remove('hidden');
            btn.classList.add('hidden');
            document.getElementById('key-cancel-btn').textContent = 'Kapat';
            toast('API anahtarÄ± oluÅŸturuldu! Åimdi kopyala ğŸ”‘', 'ok', 5000);
        } catch (e) {
            // Offline fallback
            if (!e.message.includes('OluÅŸturma') && !e.message.includes('sÄ±z')) {
                const fakeKey = 'agrolink_' + Array.from(crypto.getRandomValues(new Uint8Array(20))).map(b=>b.toString(16).padStart(2,'0')).join('');
                const entry = { id: Date.now().toString(), name, key: fakeKey, isActive:true, usageCount:0, createdAt:new Date().toISOString() };
                const c = JSON.parse(localStorage.getItem('agrodev_keys')||'[]');
                c.push(entry); localStorage.setItem('agrodev_keys', JSON.stringify(c));
                document.getElementById('new-key-value').textContent = fakeKey;
                document.getElementById('new-key-reveal').classList.remove('hidden');
                btn.classList.add('hidden');
                document.getElementById('key-cancel-btn').textContent = 'Kapat';
                toast('Anahtar oluÅŸturuldu (Ã§evrimdÄ±ÅŸÄ± mod) ğŸ”‘', 'info', 4000);
            } else {
                const err = document.getElementById('create-key-error');
                err.textContent = e.message; err.classList.remove('hidden');
                btn.textContent='OluÅŸtur'; btn.disabled=false;
            }
        }
    }

    function deleteKey(id) { deleteTargetId=id; document.getElementById('delete-modal').classList.remove('hidden'); }
    async function confirmDelete() {
        const token = currentUser?.token || localStorage.getItem('agrodev_token');
        document.getElementById('delete-modal').classList.add('hidden');
        try { await fetch(`${API_BASE}/api/dev/apikeys/${deleteTargetId}`, { method:'DELETE', headers:{'Authorization':`Bearer ${token}`} }); } catch {}
        const c = JSON.parse(localStorage.getItem('agrodev_keys')||'[]').filter(k=>k.id!==deleteTargetId);
        localStorage.setItem('agrodev_keys', JSON.stringify(c));
        toast('Anahtar silindi', 'info');
        loadApiKeys();
        deleteTargetId=null;
    }

    // ============================================================
    // PLAYGROUND
    // ============================================================
    async function sendPlayground() {
        const key = document.getElementById('pg-key-select').value;
        const message = document.getElementById('pg-message').value.trim();
        const lang = document.getElementById('pg-lang').value;
        if (!key) { toast('LÃ¼tfen bir API anahtarÄ± seÃ§in', 'err'); return; }
        if (!message) return;

        const btn = document.getElementById('pg-send-btn');
        const output = document.getElementById('pg-output');
        const status = document.getElementById('pg-status');
        btn.disabled=true;
        btn.innerHTML='<div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full spin"></div> GÃ¶nderiliyor...';
        output.textContent='AI yanÄ±tÄ± bekleniyor...';
        status.textContent='â³ Ä°ÅŸleniyor';
        document.getElementById('pg-meta').classList.add('hidden');

        const t0 = Date.now();
        try {
            const r = await fetch(`${API_BASE}/api/ai/chat`, {
                method:'POST',
                headers: { 'Content-Type':'application/json', 'X-API-Key': key },
                body: JSON.stringify({ message, context:'agriculture', lang })
            });
            const data = await r.json();
            if (!r.ok) {
                if (r.status === 429) throw new Error(`Rate limit aÅŸÄ±ldÄ±. ${data.retryAfter ? data.retryAfter+'s bekleyin.' : ''}`);
                throw new Error(data.error || `HTTP ${r.status}`);
            }
            const elapsed = ((Date.now()-t0)/1000).toFixed(2);
            output.textContent = data.reply || data.message || data.response || JSON.stringify(data, null, 2);
            document.getElementById('pg-model').textContent = data.model || 'agrolink-ai-v1';
            document.getElementById('pg-tokens').textContent = data.usage?.tokens || '?';
            document.getElementById('pg-time').textContent = elapsed + 's';
            document.getElementById('pg-meta').classList.remove('hidden');
            status.textContent='âœ… BaÅŸarÄ±lÄ±';
        } catch(e) {
            output.textContent='âŒ Hata: ' + e.message;
            status.textContent='âŒ Hata';
            toast(e.message, 'err', 5000);
        } finally {
            btn.disabled=false;
            btn.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg> GÃ¶nder';
        }
    }

    // ============================================================
    // UTILS
    // ============================================================
    function copyText(text, btn) {
        navigator.clipboard.writeText(text).then(() => {
            const orig=btn.textContent; btn.textContent='âœ… KopyalandÄ±';
            setTimeout(()=>btn.textContent=orig, 1800);
        });
    }
    function escapeHtml(str) {
        return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }
    function scrollToPlans() {
        document.getElementById('hero-plans')?.scrollIntoView({ behavior:'smooth', block:'start' });
    }

    // Close modal on backdrop click
    document.getElementById('auth-modal').addEventListener('click', function(e) { if(e.target===this) closeAuthModal(); });
    document.getElementById('delete-modal').addEventListener('click', function(e) { if(e.target===this) document.getElementById('delete-modal').classList.add('hidden'); });
    document.getElementById('create-key-modal').addEventListener('click', function(e) { if(e.target===this) closeCreateKeyModal(); });
    </script>
</body>
</html>
